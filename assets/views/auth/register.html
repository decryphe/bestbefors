<!doctype html>
<html lang="en">
    {% include "inc_head.html" %}
    <body class="container py-5" style="max-width: 520px">
        <div class="text-center mb-4">
            <h1 class="h3">Create your account</h1>
            <p class="text-muted mb-0">
                Register to start tracking intervals, expiry presets, and checklists.
            </p>
        </div>

        <div class="card shadow-sm">
            <div class="card-body">
                <form id="register-form" class="mb-3">
                    <div class="mb-3">
                        <label class="form-label" for="register-name">Full name</label>
                        <input
                            id="register-name"
                            type="text"
                            class="form-control"
                            placeholder="Pat Example"
                            required
                        />
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="register-email">Email</label>
                        <input
                            id="register-email"
                            type="email"
                            class="form-control"
                            placeholder="you@example.com"
                            required
                        />
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="register-password">Password</label>
                        <input
                            id="register-password"
                            type="password"
                            class="form-control"
                            minlength="8"
                            placeholder="At least 8 characters"
                            required
                        />
                    </div>
                    <button class="btn btn-primary w-100" type="submit">Register</button>
                </form>
                <div id="register-alert" class="alert d-none" role="alert"></div>
                <p class="text-center mb-0">
                    Already have an account?
                    <a href="/auth/login">Return to login</a>
                </p>
            </div>
        </div>

        <script>
            const registerForm = document.getElementById("register-form");
            const registerAlert = document.getElementById("register-alert");

            function showRegisterMessage(message, success = false) {
                registerAlert.textContent = message;
                registerAlert.classList.remove("d-none", "alert-danger", "alert-success");
                registerAlert.classList.add(success ? "alert-success" : "alert-danger");
            }

            registerForm.addEventListener("submit", async (event) => {
                event.preventDefault();
                const payload = {
                    name: document.getElementById("register-name").value.trim(),
                    email: document.getElementById("register-email").value.trim(),
                    password: document.getElementById("register-password").value,
                };

                try {
                    const response = await fetch("/api/auth/register", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(payload),
                    });

                    if (!response.ok) {
                        const text = await response.text();
                        showRegisterMessage(text || "Registration failed.");
                        return;
                    }

                    showRegisterMessage(
                        "Registration successful! Check your inbox for a verification email.",
                        true,
                    );
                    setTimeout(() => {
                        window.location.href = "/auth/login";
                    }, 1200);
                } catch (error) {
                    console.error(error);
                    showRegisterMessage("Network error while registering.");
                }
            });
        </script>
    </body>
</html>
